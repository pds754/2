<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playable Ad - Ride Vehicles (Sound on Interaction or Drop)</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; overflow:hidden; background:#f0f0f0; }
    #game-container { position:relative; width:100%; height:100%; }
    #background { position:absolute; top:0; left:0; width:200%; height:100%; background: url('bg_start.png') center/cover repeat-x; }
    .scrolling { animation: scroll-bg 4s linear infinite; }
    @keyframes scroll-bg { from { transform: translateX(0); } to { transform: translateX(-50%); } }
    .tutorial-active #background { filter: brightness(50%); }
    .tutorial-active .drag-btn:not(#btn1) { filter: brightness(50%); pointer-events: none; }
    #dropzone { position:absolute; top:60%; left:50%; transform:translate(-50%,-50%); width:200px; height:200px; }
    #character { position:absolute; top:60%; left:50%; transform:translate(-50%,-50%) scaleX(-1); width:clamp(240px,60vw,600px); pointer-events:none; z-index:14; }
    #tutorial-hand { position:absolute; width:clamp(40px,10vw,60px); height:clamp(40px,10vw,60px); display:none; pointer-events:none; z-index:15; }
    .btn-container { position:absolute; top:10px; left:50%; transform:translateX(-50%); display:flex; gap:5px; z-index:5; }
    .drag-btn { width:clamp(38px,14vw,96px); height:clamp(38px,14vw,96px); cursor:grab; }
    .drag-btn.disabled { opacity:0.5; cursor:default; animation:none; }
    @keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.2);}100%{transform:scale(1);} }
    .pulse { animation:pulse 1s ease-in-out infinite; }
    #banner { position:absolute; top:0; left:0; width:100vw; height:auto; opacity:0; transition: opacity 1s ease; pointer-events:none; z-index:16; }
    #banner.show-banner { opacity:1; pointer-events:auto; }
  </style>
</head>
<body>
  <div id="game-container" class="tutorial-active">
    <div id="background"></div>
    <img id="tutorial-hand" src="pointer.png" alt="Tutorial Hand">
    <div id="dropzone"><img id="character" src="character_idle.png" alt="Character"></div>
    <div class="btn-container">
      <img id="btn1" class="drag-btn pulse" draggable src="btn_vehicle1.png" data-vehicle="vehicle1.gif" data-bg="bg_vehicle1.png">
      <img id="btn2" class="drag-btn disabled" draggable="false" src="btn_vehicle2.png" data-vehicle="vehicle2.gif" data-bg="bg_vehicle2.png">
      <img id="btn3" class="drag-btn disabled" draggable="false" src="btn_vehicle3.png" data-vehicle="vehicle3.gif" data-bg="bg_vehicle3.png">
      <img id="btn4" class="drag-btn disabled" draggable="false" src="btn_vehicle4.png" data-vehicle="vehicle4.gif" data-bg="bg_vehicle4.png">
      <img id="btn5" class="drag-btn disabled" draggable="false" src="btn_vehicle5.png" data-vehicle="vehicle5.gif" data-bg="bg_vehicle5.png">
    </div>
    <img id="banner" src="banner.png" alt="Banner">
    <audio id="bgm" src="BGM2.mp3" loop></audio>
    <audio id="clickSound" src="click.mp3"></audio>
    <audio id="vehicleSound" src="vehicle.mp3"></audio>
    <audio id="winSound" src="win.mp3"></audio>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btns = Array.from(document.querySelectorAll('.drag-btn'));
      const dropzone = document.getElementById('dropzone');
      const background = document.getElementById('background');
      const character = document.getElementById('character');
      const hand = document.getElementById('tutorial-hand');
      const banner = document.getElementById('banner');
      const bgm = document.getElementById('bgm');
      const clickSound = document.getElementById('clickSound');
      const vehicleSound = document.getElementById('vehicleSound');
      const winSound = document.getElementById('winSound');
      let tutorial = true, used = 0, bgmStarted = false;

      // 공통으로 BGM 시작
      const startBgm = () => {
        if (!bgmStarted) {
          bgm.volume = 0.2;
          bgm.play().catch(() => {});
          bgmStarted = true;
        }
      };

      // 클릭 시 효과음 + BGM 시작
      document.addEventListener('click', e => {
        startBgm();
        clickSound.currentTime = 0;
        clickSound.play();
      });

      background.style.backgroundImage = `url('bg_start.png')`;

      btns.forEach((btn, i) => {
        if (i === 0) btn.draggable = true;
        else btn.classList.add('disabled');
      });
      hand.style.display = 'block';

      (function animateHand() {
        if (!tutorial) return;
        const first = btns[0];
        const bRect = first.getBoundingClientRect();
        const dRect = dropzone.getBoundingClientRect();
        hand.style.transition = 'none';
        hand.style.left = `${bRect.left + bRect.width/2 - hand.offsetWidth/2}px`;
        hand.style.top = `${bRect.top + bRect.height/2 - hand.offsetHeight/2}px`;
        setTimeout(() => {
          hand.style.transition = 'all 1s ease';
          hand.style.left = `${dRect.left + dRect.width/2 - hand.offsetWidth/2}px`;
          hand.style.top = `${dRect.top + dRect.height/2 - hand.offsetHeight/2}px`;
        }, 200);
        setTimeout(animateHand, 1400);
      })();

      document.getElementById('game-container').addEventListener('dragover', e => e.preventDefault());
      document.getElementById('game-container').addEventListener('drop', e => {
        e.preventDefault();
        const {clientX: x, clientY: y, dataTransfer} = e;
        const rect = dropzone.getBoundingClientRect();
        if (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) return;
        const vehicle = dataTransfer.getData('vehicle');
        const bgUrl = dataTransfer.getData('bg');
        if (!vehicle) return;

        // 첫 drop 시에도 BGM 시작
        startBgm();
        vehicleSound.currentTime = 0;
        vehicleSound.play();

        character.src = vehicle;
        character.style.transform = 'translate(-50%, -50%) scaleX(1)';
        background.style.backgroundImage = `url('${bgUrl}')`;
        background.classList.add('scrolling');

        const idx = btns.findIndex(b => b.dataset.vehicle === vehicle);
        btns[idx].classList.add('disabled');
        btns[idx].draggable = false;

        if (tutorial && idx === 0) {
          tutorial = false;
          document.getElementById('game-container').classList.remove('tutorial-active');
          hand.style.display = 'none';
          btns[0].classList.remove('pulse');
          btns.slice(1).forEach(b => { b.classList.remove('disabled'); b.draggable = true; b.classList.add('pulse'); });
          const cRect = character.getBoundingClientRect();
          dropzone.style.width = `${cRect.width}px`;
          dropzone.style.height = `${cRect.height}px`;
        }

        if (!tutorial && idx > 0) btns[idx].classList.remove('pulse');

        used++;
        if (used === btns.length) {
          setTimeout(() => {
            banner.classList.add('show-banner');
            winSound.currentTime = 0;
            winSound.play();
          }, 1000);
        }
      });

      btns.forEach(btn => btn.addEventListener('dragstart', e => {
        if (!btn.draggable) return;
        e.dataTransfer.setData('vehicle', btn.dataset.vehicle);
        e.dataTransfer.setData('bg', btn.dataset.bg);
      }));
    });
  </script>
</body>
</html>
